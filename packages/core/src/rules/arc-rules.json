{
  "$schema": "./rules-schema.json",
  "name": "Arc Blockchain Security Rules",
  "version": "1.0.0",
  "description": "Security rules specific to the Arc blockchain ecosystem",
  "rules": [
    {
      "id": "ARC001",
      "name": "Using block.prevrandao",
      "severity": "critical",
      "category": "randomness",
      "description": "block.prevrandao is always 0 on Arc - do not use for randomness",
      "patterns": ["block\\.prevrandao", "block\\.difficulty"],
      "cwe": "CWE-330",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Use Chainlink VRF or another verifiable randomness source"
    },
    {
      "id": "ARC002",
      "name": "Hardcoded 6 Decimal Assumption",
      "severity": "critical",
      "category": "decimals",
      "description": "Arc native USDC uses 18 decimals, ERC-20 interface uses 6. Mixing causes loss of funds.",
      "patterns": ["10\\s*\\*\\*\\s*6", "1000000", "1e6"],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Use decimals() to get correct precision, or explicitly handle both interfaces"
    },
    {
      "id": "ARC003",
      "name": "Strict Timestamp Comparison",
      "severity": "high",
      "category": "timing",
      "description": "Multiple blocks can share same timestamp on Arc - strict comparisons may fail",
      "patterns": ["block\\.timestamp\\s*==", "block\\.timestamp\\s*!=", "require\\s*\\(\\s*block\\.timestamp\\s*>"],
      "cwe": "CWE-367",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Use >= or <= instead of strict equality for timestamp checks"
    },
    {
      "id": "ARC004",
      "name": "Unnecessary Confirmation Waits",
      "severity": "low",
      "category": "finality",
      "description": "Arc has instant deterministic finality - no need to wait for confirmations",
      "patterns": ["block\\.number\\s*>\\s*\\w+\\s*\\+\\s*\\d+", "confirmations", "waitForConfirmation"],
      "cwe": null,
      "enabled": true,
      "arcSpecific": true,
      "fix": "Arc transactions are final immediately - single confirmation is sufficient"
    },
    {
      "id": "ARC005",
      "name": "SELFDESTRUCT in Constructor",
      "severity": "critical",
      "category": "deployment",
      "description": "SELFDESTRUCT during deployment reverts on Arc if sending value to self",
      "patterns": ["constructor[^}]*selfdestruct", "constructor[^}]*suicide"],
      "cwe": "CWE-670",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Avoid selfdestruct in constructors, or ensure no value is sent to self"
    },
    {
      "id": "ARC006",
      "name": "Missing USDC Blocklist Handling",
      "severity": "medium",
      "category": "compliance",
      "description": "Arc enforces USDC blocklists - transfers to/from blocklisted addresses revert",
      "patterns": ["transfer\\(", "transferFrom\\("],
      "cwe": "CWE-754",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Implement try-catch for USDC transfers to handle blocklist reverts gracefully"
    },
    {
      "id": "ARC007",
      "name": "Mixed Decimal Interface Usage",
      "severity": "high",
      "category": "decimals",
      "description": "Mixing native (18 decimals) and ERC-20 (6 decimals) USDC interfaces",
      "patterns": ["balanceOf.*msg\\.value", "transfer.*10\\*\\*18.*10\\*\\*6"],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Be consistent with decimal handling - native balance is 18, ERC-20 is 6"
    },
    {
      "id": "ARC008",
      "name": "Gas Price Assumption",
      "severity": "medium",
      "category": "gas",
      "description": "Arc has different gas mechanics - hardcoded gas prices may fail",
      "patterns": ["gasPrice", "tx\\.gasprice", "gasleft\\(\\)\\s*<"],
      "cwe": "CWE-400",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Use dynamic gas estimation or Arc-specific gas handling"
    },
    {
      "id": "ARC009",
      "name": "Cross-Chain Bridge Vulnerability",
      "severity": "critical",
      "category": "bridge",
      "description": "Bridge contracts must validate source chain and message authenticity",
      "patterns": ["bridgeFrom", "crossChain", "layerZero", "wormhole", "chainId"],
      "cwe": "CWE-345",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Validate chainId, verify message signatures, implement replay protection"
    },
    {
      "id": "ARC010",
      "name": "Validator Set Dependency",
      "severity": "high",
      "category": "consensus",
      "description": "Logic dependent on validator set may behave differently on Arc",
      "patterns": ["coinbase", "block\\.coinbase", "validator"],
      "cwe": "CWE-362",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Don't rely on specific validator behavior or coinbase address"
    },
    {
      "id": "ARC011",
      "name": "Native Token Handling",
      "severity": "high",
      "category": "token",
      "description": "Arc native token (USDC) differs from ETH - ensure correct handling",
      "patterns": ["msg\\.value", "payable", "\\.value\\("],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Verify native token assumptions, handle USDC specifics"
    },
    {
      "id": "ARC012",
      "name": "Sequencer Dependency",
      "severity": "medium",
      "category": "infrastructure",
      "description": "Logic dependent on sequencer ordering may be exploited",
      "patterns": ["block\\.number", "getBlockNumber", "latestBlock"],
      "cwe": "CWE-362",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Don't assume specific block ordering, implement MEV protection"
    },
    {
      "id": "ARC013",
      "name": "Precompile Usage",
      "severity": "medium",
      "category": "compatibility",
      "description": "Some EVM precompiles may behave differently or not exist on Arc",
      "patterns": ["ecrecover", "sha256", "ripemd160", "modexp", "ecAdd", "ecMul", "ecPairing"],
      "cwe": "CWE-573",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Test precompile behavior on Arc testnet before mainnet deployment"
    },
    {
      "id": "ARC014",
      "name": "L2 Specific Opcodes",
      "severity": "high",
      "category": "compatibility",
      "description": "Some opcodes behave differently on L2s like Arc",
      "patterns": ["PUSH0", "BASEFEE", "SELFBALANCE", "CHAINID"],
      "cwe": "CWE-573",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Verify opcode compatibility with Arc's execution environment"
    },
    {
      "id": "ARC015",
      "name": "Withdrawal Delay Handling",
      "severity": "medium",
      "category": "bridge",
      "description": "L2 to L1 withdrawals have delay periods that must be handled",
      "patterns": ["withdraw", "exitL2", "finalizeWithdrawal"],
      "cwe": "CWE-367",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Implement proper withdrawal delay handling and user notifications"
    },
    {
      "id": "ARC016",
      "name": "USYC Decimal Mismatch",
      "severity": "critical",
      "category": "decimals",
      "description": "USYC uses 6 decimals (not 18 like Arc native). Mixing causes loss of funds.",
      "patterns": ["USYC", "0xe9185F0c5F296Ed1797AaE4238D26CCaBEadb86C"],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "USYC uses 6 decimals. Always call decimals() and handle accordingly."
    },
    {
      "id": "ARC017",
      "name": "Missing USYC Allowlist Check",
      "severity": "high",
      "category": "compliance",
      "description": "USYC requires allowlisting via Entitlements contract. Transfers to non-allowlisted addresses will revert.",
      "patterns": ["USYC", "0xe9185F0c5F296Ed1797AaE4238D26CCaBEadb86C", "Entitlements"],
      "cwe": "CWE-754",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Check Entitlements contract (0xcc205224862c7641930c87679e98999d23c26113) before USYC transfers"
    },
    {
      "id": "ARC018",
      "name": "USYC Balance Assumption",
      "severity": "medium",
      "category": "token",
      "description": "USYC is yield-bearing - balances can change over time without transfers",
      "patterns": ["USYC.*balanceOf", "balance.*USYC"],
      "cwe": "CWE-362",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Don't cache USYC balances - they accrue yield and change over time"
    },
    {
      "id": "ARC019",
      "name": "Invalid CCTP Domain",
      "severity": "critical",
      "category": "bridge",
      "description": "Arc's CCTP domain ID is 26. Using wrong domain causes failed cross-chain transfers.",
      "patterns": ["destinationDomain", "sourceDomain", "CCTP", "TokenMessenger"],
      "cwe": "CWE-345",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Arc CCTP domain = 26. Ethereum = 0, Avalanche = 1, Base = 6. Validate domain IDs."
    },
    {
      "id": "ARC020",
      "name": "Gateway Transfer Instead of Deposit",
      "severity": "critical",
      "category": "bridge",
      "description": "Gateway requires deposit() function, not standard transfer(). Direct transfers are lost.",
      "patterns": ["GatewayWallet", "0x0077777d7EBA4688BDeF3E311b846F25870A19B9", "Gateway.*transfer"],
      "cwe": "CWE-670",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Use GatewayWallet.deposit(token, amount) instead of transfer(). Direct transfers don't credit unified balance."
    },
    {
      "id": "ARC021",
      "name": "Gateway Signature Replay",
      "severity": "critical",
      "category": "bridge",
      "description": "Gateway burn intents use EIP-712 signatures. Missing salt/nonce allows replay attacks.",
      "patterns": ["burnIntent", "GatewayMinter", "gatewayMint", "EIP712"],
      "cwe": "CWE-294",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Include random salt in burn intents. Verify attestation signatures before minting."
    },
    {
      "id": "ARC022",
      "name": "Missing Permit2 Deadline",
      "severity": "high",
      "category": "authorization",
      "description": "Permit2 signatures without deadline can be replayed indefinitely",
      "patterns": ["Permit2", "0x000000000022D473030F116dDEE9F6B43aC78BA3", "permit2"],
      "cwe": "CWE-294",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Always include reasonable deadline in Permit2 signatures. Validate deadline on-chain."
    },
    {
      "id": "ARC023",
      "name": "FxEscrow Settlement Timing",
      "severity": "high",
      "category": "settlement",
      "description": "StableFX escrow has timing requirements. Early/late settlement may fail or lock funds.",
      "patterns": ["FxEscrow", "0x1f91886C7028986aD885ffCee0e40b75C9cd5aC1", "StableFX"],
      "cwe": "CWE-367",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Handle escrow expiry and settlement windows correctly. Implement timeout handling."
    },
    {
      "id": "ARC024",
      "name": "EURC Decimal Handling",
      "severity": "high",
      "category": "decimals",
      "description": "EURC uses 6 decimals. Don't confuse with Arc native USDC (18 decimals).",
      "patterns": ["EURC", "0x89B50855Aa3bE2F677cD6303Cec089B5F319D72a"],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "EURC uses 6 decimals like standard stablecoins. Always use decimals() function."
    },
    {
      "id": "ARC025",
      "name": "Blob Transaction Attempt",
      "severity": "medium",
      "category": "compatibility",
      "description": "EIP-4844 blob transactions are disabled on Arc. Blob-dependent code will fail.",
      "patterns": ["blobVersionedHashes", "BLOBHASH", "blobGas", "blob"],
      "cwe": "CWE-573",
      "enabled": true,
      "arcSpecific": true,
      "fix": "EIP-4844 blobs are disabled on Arc. Use alternative data availability solutions."
    },
    {
      "id": "ARC026",
      "name": "PARENT_BEACON_BLOCK_ROOT Usage",
      "severity": "medium",
      "category": "compatibility",
      "description": "Arc has no beacon chain. PARENT_BEACON_BLOCK_ROOT returns keccak256(RLP(header)) not SSZ root.",
      "patterns": ["parentBeaconBlockRoot", "BEACON_ROOT"],
      "cwe": "CWE-573",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Don't rely on beacon chain data. Arc uses keccak256(RLP(header)) instead."
    },
    {
      "id": "ARC027",
      "name": "Multi-Stablecoin FX Risk",
      "severity": "medium",
      "category": "settlement",
      "description": "FX between stablecoins (USDC/EURC/USYC) requires proper decimal and rate handling",
      "patterns": ["swap.*USDC.*EURC", "exchange.*stablecoin", "FX.*rate"],
      "cwe": "CWE-682",
      "enabled": true,
      "arcSpecific": true,
      "fix": "Handle decimal differences (USDC native=18, ERC20=6, EURC=6, USYC=6). Validate FX rates."
    }
  ]
}
